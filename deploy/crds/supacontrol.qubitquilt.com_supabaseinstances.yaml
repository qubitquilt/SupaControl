apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: supabaseinstances.supacontrol.qubitquilt.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.3
spec:
  group: supacontrol.qubitquilt.com
  names:
    kind: SupabaseInstance
    listKind: SupabaseInstanceList
    plural: supabaseinstances
    singular: supabaseinstance
    shortNames:
      - sbi
      - sbinst
  scope: Cluster
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          description: SupabaseInstance is the Schema for the supabaseinstances API
          type: object
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object.'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents.'
              type: string
            metadata:
              type: object
            spec:
              description: SupabaseInstanceSpec defines the desired state of SupabaseInstance
              type: object
              required:
                - projectName
              properties:
                projectName:
                  description: ProjectName is the unique identifier for this Supabase instance
                  type: string
                  pattern: '^[a-z0-9]([a-z0-9-]*[a-z0-9])?$'
                ingressClass:
                  description: IngressClass specifies the Kubernetes ingress class to use
                  type: string
                ingressDomain:
                  description: IngressDomain specifies the base domain for instance URLs
                  type: string
                chartVersion:
                  description: ChartVersion specifies the Supabase Helm chart version to use
                  type: string
                paused:
                  description: Paused indicates whether reconciliation should be paused
                  type: boolean
            status:
              description: SupabaseInstanceStatus defines the observed state of SupabaseInstance
              type: object
              properties:
                phase:
                  description: Phase represents the current phase of the instance
                  type: string
                  enum:
                    - Pending
                    - Provisioning
                    - ProvisioningInProgress
                    - Running
                    - Deleting
                    - DeletingInProgress
                    - Failed
                conditions:
                  description: Conditions represent the latest available observations of the instance's state
                  type: array
                  items:
                    type: object
                    required:
                      - lastTransitionTime
                      - message
                      - reason
                      - status
                      - type
                    properties:
                      lastTransitionTime:
                        description: lastTransitionTime is the last time the condition transitioned
                        type: string
                        format: date-time
                      message:
                        description: message is a human readable message indicating details about the transition
                        type: string
                        maxLength: 32768
                      observedGeneration:
                        description: observedGeneration represents the .metadata.generation that the condition was set based upon
                        type: integer
                        format: int64
                        minimum: 0
                      reason:
                        description: reason contains a programmatic identifier indicating the reason for the condition's last transition
                        type: string
                        maxLength: 1024
                        minLength: 1
                        pattern: '^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$'
                      status:
                        description: status of the condition
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      type:
                        description: type of condition
                        type: string
                        maxLength: 316
                        pattern: '^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$'
                namespace:
                  description: Namespace is the Kubernetes namespace where the instance is deployed
                  type: string
                studioUrl:
                  description: StudioURL is the URL to access the Supabase Studio UI
                  type: string
                apiUrl:
                  description: APIURL is the URL to access the Supabase API
                  type: string
                errorMessage:
                  description: ErrorMessage contains error details if the instance is in Failed phase
                  type: string
                observedGeneration:
                  description: ObservedGeneration reflects the generation of the most recently observed spec
                  type: integer
                  format: int64
                lastTransitionTime:
                  description: LastTransitionTime is the last time the phase transitioned
                  type: string
                  format: date-time
                helmReleaseName:
                  description: HelmReleaseName is the name of the Helm release
                  type: string
                provisioningJobName:
                  description: ProvisioningJobName is the name of the current/last provisioning Job
                  type: string
                cleanupJobName:
                  description: CleanupJobName is the name of the current/last cleanup Job
                  type: string
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Project
          type: string
          jsonPath: .spec.projectName
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Namespace
          type: string
          jsonPath: .status.namespace
        - name: Studio URL
          type: string
          jsonPath: .status.studioUrl
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
